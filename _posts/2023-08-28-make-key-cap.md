---
layout: post
title:  "FDM方式の3Dプリンターでkailh choc v1用キーキャップを作った"
date:   2023-08-28 02:19:14 +0900
categories: making
---

kailh choc v1というキースイッチにはめられるキーキャップが欲しくて作りました。

kailh choc v1用のキーキャップって本当に種類が少ない。なので有志のかたがDMM.makeなどの3Dプリントサービスで発注できるようにデータを公開してくださってたりします。

しかし、ああいったサービスから注文すると費用がそれなりにかかります。キーボードひとつ分を作るために1万円近く飛んでしまう。出力精度や扱える素材を勘案すると妥当な金額ではあるのですが、そこまでこだわりが無いと気が引けてしまう額です。それならいっそ3Dプリンターを買って自分でプリントしたほうがいいのでは？と思い立ち、買って、モデリングして、印刷しました。この記事はその記録です。

以下にキーキャップをモデリングした際のソースコードを置いておきます。

- [Kailh choc v1 用レバーレスコントローラーキーキャップ（丸）](https://github.com/heutronica/blog/blob/main/20230828-makeKeycap/source/kailh_choc_v1-circle_keycap.py)
- [Kailh choc v1 用キーキャップ（四角）](https://github.com/heutronica/blog/blob/main/20230828-makeKeycap/source/kailh_choc_v1-rect_keycap.py)

STLファイルではなくpyファイルです。Pythonと後述のCadQueryを導入したあと、変数をぽちぽちいじって実行すれば欲しい大きさのキーキャップのSTLファイルが出力されます。キートップ部分はPLA、ステム部分はABSで出力する前提だったので、分割された2つのSTLファイルが出力されるはずです。

コードについては、基本的に `stem` のサイズと配置間隔さえイジらなければ、他の部分は何をしようが問題なくキーキャップとして成立すると思います。

## FDM方式の3Dプリンターで印刷するにあたって

3Dプリンターできれいに印刷するために考慮すべきことは多くあります。が、結局は以下の事柄を念頭に置きつつ、3Dプリンターの設定をいじったりモデルを作ったりすれば良いようです。

- 熱で溶かしたフィラメントを積層して形状をつくる
- フィラメントごとの素材特性

この2点さえ分かっていれば、うつくしく仕上がらなかった印刷物を目にした時に比較的はやく問題の切り分けができ、手当たり次第に設定をいじりまくるという徒労を少なくできるように思います。

たとえば、FDM方式の3Dプリンターは熱で溶かしたフィラメントを積層して形状をつくっていくので、橋の脚と脚の間のように下の支えが無いものは形が崩れがちです（そういった形状のことを **ブリッジ** と言います）。ブリッジのあるモデルをきれいに印刷したいのであれば、以下のような対策が考えられます。
 - ブリッジ部が崩れないように下から支えるサポート材を付ける
 - ノズルから吐き出されたフィラメントが崩れ落ちてしまう前に固まるよう、フィラメントがゆっくり吐出されるように速度を落とし、ファンの回転数を上げる
 - モデルの印刷向きを変える

そんなかんじ。

とはいえ、スライサーソフトについての動画をいくつか見て、あとは設定いじりながら出力しながらコツをつかむのがよいような。これとか見ていました。
[3Dプリンタスキルアップ配信 Session.1](https://www.youtube.com/watch?v=pkHRVHn5y0Q&t=2114s)


## 使用ツール

### 3Dプリンター
Anycubic社の[Kobra 2](https://www.anycubic.com/products/kobra-2)を買いました。Amazonにてセール価格で4万円。とても安い。

購入してから一週間ほぼ毎日動かしていますが、いまのところ特にトラブルもなく扱えています。…いや、オーバーハングがうまく出力できないだとか、ABSフィラメントで印刷したら糸引きがヤバいだとか、そういった3Dプリンター共通のお悩みには苦しめられていますが…Kobra 2自体の問題というのは初心者にはわかりません。なにかあるのかな。

### スライサーソフト

特にこだわりがないので、Kobra 2 についてくるmicroSDに入っていた [Prusa Slicer](https://www.prusa3d.com/page/prusaslicer_424/)を使いました。Anycubic製のものもあるのですが、情報量としてはPrusa Slicerのほうが多いように思います。

なお、Kobra 2ユーザーは大人しくmicroSDに付属しているインストーラーからインストールするのが良いです。Prusa公式から配布されているPrusa SlicerにはKobra 2のプロファイルが含まれておらず、わざわざRedditを探ってKobra 2のプリンタープロファイルをダウンロードしてくる羽目になります。なりました。


### CAD
[CadQuery](https://github.com/CadQuery/cadquery)というPythonライブラリを使ってモデリングしました。
3DCGソフトウェアのHoudiniのように、手続き的にモデリングすることができます。

併せて、[cq-server](https://github.com/roipoussiere/cadquery-server)もインストールしています。これはWebサーバーを立てて、ブラウザ上でCadQueryのレンダリング結果を確認できるものです。[CQ-editor](https://github.com/CadQuery/CQ-editor)というGUIもあるのですが、自分はWSL2を用いていて、設定が面倒な雰囲気を感じたのでこちらを選んでいます。

使い方は公式ドキュメントの[Examples](https://cadquery.readthedocs.io/en/latest/examples.html)を眺めるのが一番手っ取り早そうです。簡単な形状ならメソッドチェーンで繋げていくだけでも作れるので、普段Pythonを触らない自分でも簡単に書けました。

複雑だったり有機的な形状でないのであれば、CadQueryはサッと書けて好きです。基本的に「そこに書いてあることがすべて」であってほしいので、3DCADソフトのような見る箇所があちこちに点在しているのはあんまり好きではありません。パラメーターをいじるだけで様々なパターンを生み出せるパラメトリックデザインの考えも性に合っています。

## 制作の備忘録

### キーキャップ（PLA製）

#### モデリング
忘れてしまった。

#### スライサーの設定

![サポート材が詰まっている様子](/assets/2023-08-28-make-key-cap/img/image-3.png)

- キーキャップの内側が長いブリッジになってしまうのでサポート材をミチミチに付与したものの、サポート材を剥離するのが大変だった
- 天面はトップインフィルをゆっくり+細く吐出するよう設定するとキレイに仕上がる
    - この、ゆっくり+細く吐出、というのは天面に限らずキレイに仕上がりますが、その分印刷速度が落ちます。キーキャップは小さいのでそこまでツラくはない…
  - 天面のパターンをアルキメデス曲線にしたら格好良かった

### ステム（ABS製）

#### モデリング
![ステムプレートの断面図](/assets/2023-08-28-make-key-cap/img/image-5.png)

- 薄い割にそこそこ精度を求められるので、印刷時の積層ピッチや、吐出幅を念頭にモデリング
  - 吐出幅 0.4mmなら、* 3 して 1.2mm くらいかな～とか…そんなかんじ…
  - ぶっちゃけそこまで気にしなくてもいいのかもしれません

#### スライサーの設定

![保護シールドに覆われているステムたち](/assets/2023-08-28-make-key-cap/img/image-4.png)

ABSという素材は冷却速度が早いと反りやすい・収縮しやすいそうで、それ由来のトラブルに苦しめられました。

- スカート > 保護シールドを有効にする
  - 保護シールド（ドラフトシールド）は、モデルの周りにシールドをつくり、熱をシールド内に閉じ込めることで冷却速度をゆるやかにしよう、というもの
  - 造形途中で大きなズレが頻発していて困っていたが、シールドを一緒に印刷することでズレが発生しなくなった
  - 参考: [[FDM】ドラフトシールドによる反り対策](https://note.com/newspeak/n/n590d4590aaf1)
- ベッドにスティックのりを塗る
  - スカートがベッドプレートに定着せず、印刷時に前後左右に動いてしまうので塗った
  - ヘアスプレーのケープとかでも良いらしい
- 積層方向に折れやすいのは諦める
  - どうせキートップと貼り付けるので…それまで丁重に扱えばよいかなと…
  - サポート材と本体を分離する作業に神経を使う
    - めちゃくちゃ折った


あとは別々に出力したキーキャップとステムを接着剤でくっつけておしまい。
気が向いたら完成品の写真を撮ります。オモチャみたいでかわいいです。

## 余談
### フィラメントケースをつくった

PLAフィラメントは湿度が敵、ということで、キーキャップ作るよりも前にさっさとフィラメントケースを作りました。3Dモデルを公開してくれている先人に感謝。

[無料3D公開！激安3モードの防湿フィラメントケース & ホルダー](https://www.youtube.com/watch?v=bxjvUW-gbow)

作ったのはフィラメントのスプールを置く台にベアリングが使用されているタイプです。湿度を防ぎつつ、フィラメントがスルスルと供給できていていい感じ。

このフィラメントケースがはじめての3Dプリンターでの出力物でした。人様のデータではありますが、出力したものをパチパチと組み立てて形になった瞬間は、出来あいの製品を組み立てたときとはまた違う興奮がありますね。欲しいものを手元でささっと作れるというのは本当に贅沢です。最高～